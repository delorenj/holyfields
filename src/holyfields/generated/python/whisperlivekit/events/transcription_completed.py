# generated by datamodel-codegen:
#   filename:  transcription_completed.json
#   timestamp: 2026-01-27T15:43:49+00:00

from __future__ import annotations

from enum import IntEnum, StrEnum
from typing import Literal
from uuid import UUID

from pydantic import AwareDatetime, BaseModel, ConfigDict, Field


class BitDepth(IntEnum):
    """
    Audio bit depth
    """

    integer_8 = 8
    integer_16 = 16
    integer_24 = 24
    integer_32 = 32


class Format(StrEnum):
    """
    Audio format
    """

    pcm = "pcm"
    wav = "wav"
    mp3 = "mp3"
    opus = "opus"


class AudioMetadata(BaseModel):
    """
    Metadata about the audio that was transcribed
    """

    model_config = ConfigDict(
        extra="allow",
    )
    duration_ms: int = Field(..., ge=0)
    """
    Duration of the audio segment in milliseconds
    """
    sample_rate: int = Field(..., ge=8000, le=48000)
    """
    Audio sample rate in Hz (e.g., 16000)
    """
    channels: int = Field(..., ge=1, le=2)
    """
    Number of audio channels (1=mono, 2=stereo)
    """
    bit_depth: BitDepth | None = None
    """
    Audio bit depth
    """
    format: Format
    """
    Audio format
    """
    language: str | None = Field(None, pattern="^[a-z]{2}$")
    """
    Detected or specified language code (ISO 639-1, e.g., 'en', 'es')
    """
    confidence: float | None = Field(None, ge=0.0, le=1.0)
    """
    Transcription confidence score (0.0 to 1.0)
    """


class BaseVoiceEvent(BaseModel):
    """
    Base schema for all voice-related events across the Hey-Ma ecosystem. Provides common fields for transcription, audio metadata, and session tracking. All voice component events extend this base.
    """

    event_type: str = Field(
        ...,
        examples=[
            "whisperlivekit.transcription.completed",
            "whisperlivekit.transcription.partial",
            "tonny.response.completed",
        ],
        pattern="^[a-z0-9]+\\.[a-z0-9._]+$",
    )
    """
    Event discriminator for routing (e.g., 'whisperlivekit.transcription.completed'). Used by Bloodbank for topic-based routing.
    """
    timestamp: AwareDatetime
    """
    ISO 8601 UTC timestamp when event was emitted
    """
    session_id: UUID
    """
    UUID of the voice session this event relates to. Used for event correlation and tracing across the voice-to-response pipeline.
    """
    source: str = Field(
        ...,
        examples=["whisperlivekit", "tonny", "candybar", "elevenlabs"],
        pattern="^[a-z0-9_-]+$",
    )
    """
    Component that emitted this event (e.g., 'whisperlivekit', 'tonny', 'candybar')
    """
    target: str = Field(
        ...,
        examples=["tonny", "candybar", "candystore", "all"],
        pattern="^[a-z0-9_-]+$",
    )
    """
    Intended consumer of this event (e.g., 'tonny', 'candybar'). Used for targeted routing.
    """


class TranscriptionCompletedEvent(BaseVoiceEvent):
    """
    Emitted when WhisperLiveKit completes transcription of an audio segment. This event triggers the voice-to-response pipeline by notifying Tonny agent and other consumers.
    """

    model_config = ConfigDict(
        extra="forbid",
    )
    event_type: Literal["whisperlivekit.transcription.completed"]
    """
    Event type discriminator
    """
    text: str = Field(..., max_length=10000, min_length=1)
    """
    Transcribed text from the audio segment
    """
    audio_metadata: AudioMetadata
    """
    Metadata about the audio that was transcribed
    """
    is_final: bool | None = True
    """
    Whether this is a final transcription (true) or partial/streaming result (false)
    """
    segment_id: str | None = None
    """
    Unique identifier for this audio segment within the session
    """
    timestamp: AwareDatetime
    """
    ISO 8601 UTC timestamp when event was emitted
    """
    session_id: UUID
    """
    UUID of the voice session this event relates to. Used for event correlation and tracing across the voice-to-response pipeline.
    """
    source: str = Field(
        ...,
        examples=["whisperlivekit", "tonny", "candybar", "elevenlabs"],
        pattern="^[a-z0-9_-]+$",
    )
    """
    Component that emitted this event (e.g., 'whisperlivekit', 'tonny', 'candybar')
    """
    target: str = Field(
        ...,
        examples=["tonny", "candybar", "candystore", "all"],
        pattern="^[a-z0-9_-]+$",
    )
    """
    Intended consumer of this event (e.g., 'tonny', 'candybar'). Used for targeted routing.
    """
