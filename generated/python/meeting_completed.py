# generated by datamodel-codegen:
#   filename:  meeting_completed.json
#   timestamp: 2026-01-25T15:24:35+00:00

from __future__ import annotations

from enum import StrEnum
from typing import Literal
from uuid import UUID

from pydantic import AwareDatetime, BaseModel, ConfigDict, Field

from base_event import BaseEvent


class StoppingReason(StrEnum):
    """
    Reason the meeting stopped
    """

    convergence = "convergence"
    max_rounds = "max_rounds"
    manual = "manual"


class Category(StrEnum):
    """
    Comment category
    """

    question = "question"
    concern = "concern"
    idea = "idea"
    observation = "observation"
    recommendation = "recommendation"
    clarification = "clarification"
    other = "other"


class TopComment(BaseModel):
    model_config = ConfigDict(
        extra="forbid",
    )
    text: str = Field(..., max_length=5000, min_length=1)
    """
    Comment text
    """
    category: Category
    """
    Comment category
    """
    novelty_score: float = Field(..., ge=0.0, le=1.0)
    """
    Novelty score (0.0 = repetitive, 1.0 = novel)
    """
    agent_name: str = Field(..., max_length=100, min_length=1)
    """
    Agent who authored the comment
    """
    round_num: int = Field(..., ge=1)
    """
    Round number when comment was made
    """


class MeetingCompletedEvent(BaseEvent):
    """
    Emitted when meeting completes successfully. Payload contains final meeting state, metrics, and extracted insights (Phase 3A).
    """

    model_config = ConfigDict(
        extra="forbid",
    )
    event_type: Literal["meeting.completed"]
    """
    Event type discriminator
    """
    total_rounds: int = Field(..., ge=1)
    """
    Total number of discussion rounds completed
    """
    total_comments: int = Field(..., ge=0)
    """
    Total comments extracted across all rounds
    """
    total_cost: float = Field(..., ge=0.0)
    """
    Total cost in USD for all LLM calls
    """
    convergence_detected: bool
    """
    Whether convergence was detected before max_rounds
    """
    stopping_reason: StoppingReason
    """
    Reason the meeting stopped
    """
    top_comments: list[TopComment] = Field(..., max_length=5)
    """
    Top 5 comments ranked by novelty score (Phase 3A insights)
    """
    category_distribution: dict[str, int]
    """
    Distribution of comments by category (question, concern, idea, etc.)
    """
    agent_participation: dict[str, int]
    """
    Number of responses per agent
    """
    timestamp: AwareDatetime
    """
    ISO 8601 UTC timestamp when event was emitted
    """
    meeting_id: UUID = Field(
        ..., pattern="^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$"
    )
    """
    UUID of the meeting this event relates to. Used for event correlation and tracing.
    """
